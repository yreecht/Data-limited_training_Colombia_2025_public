<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to LBSPR</title>
    <meta charset="utf-8" />
    <meta name="author" content="Hector Antonio Andrade Rodriguez, Yves Reecht" />
    <script src="libs/header-attrs-2.29/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/hygge-duke.css" rel="stylesheet" />
    <link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.33/datatables.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Introduction to LBSPR
]
.subtitle[
## Cali workshop - May 26<sup>th</sup>-29<sup>th</sup>, 2025
]
.author[
### Hector Antonio Andrade Rodriguez, Yves Reecht
]
.institute[
### Institute of Marine Research <a href="https://www.hi.no/en"><img src="https://www.hi.no/en/hi/resources/layout/HI-logo-farger-engelsk.svg/original" alt="Institute of Marine Research" width="55"/></a>
]

---


&lt;!-- Layout options and styles --&gt;

&lt;!-- Packages to load --&gt;

# Theoretical basis


---

## Life history "invariants" / theory

.pull-left[
Reminder from last lecture:

* Life history shapes the size composition of a population.

* There are combinations of life history traits (LHT) which are more likely than others.

    * they tend to co-vary with life history strategies (! some of them define these strategies)

    * species from a same group are more likely to share some life history.

    * ...but there may be strong variations within a same taxonomic group

    * [**new**]: there may be large variations within a same species*****!
]

.pull-right[&lt;img src="./img/Prince_2015_1.png" alt="M/k - Lm/Linf" width="80%"&gt;
&lt;img src="./img/Prince_2015_2.png" alt="Linf - M/k" width="80%"&gt;

&lt;small&gt;[(Prince *et al.*, 2015)](https://doi.org/10.1093/icesjms/fsu011).&lt;/small&gt;
]&lt;br /&gt;

.footnote[[*] A somehow prominent example is the temperature-size rule: phenotypic response which results in
  individuals of a same (ectotherm) species tending to have larger asymptotic sizes (`\(L_{\infty}\)`)
  and maturation size when they inhabit colder environments.]

--

  =&gt; Beyond the obvious estimation uncertainty, **do not trust blindly any LHT found for the same species**!


---

## Population at equilibrium

.pull-left[At equilibrium (constant recruitment and mortality), 

  * the size composition of the population is mainly shaped by `\(M/k\)` and scaled by `\(L_{\infty}\)`.

  * the length at maturity (as a proportion of `\(L_{\infty}\)`), will determine how cramped against the
    largest sizes the fraction mature will be.

]

.pull-right[
&lt;img src="./img/Prince_2015_size_comp.png" alt="Size compositions at equilibrium" width="100%"/&gt;
]

---

.pull-left[
## Population at equilibrium

At equilibrium (constant recruitment and mortality), with fishing, 

  * Selectivity is often considered sigmoidal (i.e. logistic curve)...

  * ...other (non-asymptotic) selectivities could be theoretically used to estimate the equilibrium.

  * the fishing mortality will operate size-selective removal (additional mortality), and, if
    constant, the size composition will tend towards a new equilibrium...
    
    `\(M/k\)` becomes `\((M+F)/k\)` over `\(L_c\)`.

  * If the population is observed from fisheries data, selectivity also affect which fraction of the
population is actually observed (left-truncation) 
]

--
.pull-right[
&lt;img src="./img/logistic.png" alt="Logistic function" width="60%"/&gt;&lt;br /&gt;
&lt;small&gt;from [Sampson (2014)](https://www.sciencedirect.com/science/article/pii/S0165783613002312?via%3Dihub), modified by Kotaro Ono&lt;/small&gt;

***

&lt;img src="./img/Hordyk_2015_SizeComp_CV_Lc.png" alt="Observed fished compositions at equilibrium knife-edge" width="47%"/&gt;
&lt;img src="./img/Hordyk_2015_SizeComp_CV_Lc-logit_annot.png" alt="Observed fished compositions at equilibrium" width="51%"/&gt;&lt;br /&gt;
&lt;small&gt;[(Hordyk *et al.*, 2015)](http://icesjms.oxfordjournals.org/cgi/doi/10.1093/icesjms/fst235)&lt;/small&gt;
]

---

### Size compositions (population / observed)...

...with `\(M/k = 1.5\)`, `\(L_{\infty} = 100\)` (`\(CV_{L_{\infty}} = 0.1\)`), `\(L_{mat~50\%} = 65\)` and `\(L_{sel~50\%} = 50\)`: 


&lt;img src="02_Introduction_LBSPR_files/figure-html/unnamed-chunk-2-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

### Spawning potential ratio (SPR)

&gt; The spawning potential ratio (SPR) of a stock is defined as the proportion of the unfished reproductive potential left at any given level of fishing pressure. 
[(Hordyk *et al.*, 2015b)](http://icesjms.oxfordjournals.org/cgi/doi/10.1093/icesjms/fsu004)

--

  * largest individuals usually have a larger reproduction potential in fish (fecundity `\(\propto\)`
    weight).
    
    *  **=&gt; importance of the weight-length relationships parameters *a* and *b***: `\(W = aL^b\)`.

    * Egg production depends on the maturity ogive too: `\(E \propto Mat_l \times W_l\)`

--

  * Intuitively: largest individuals have the largest reproductive potential `\(\times\)` selective
    removal of the largest  
    =&gt; reduction of reproductive potential.

.pull-left[&lt;img src="./img/Hordyk_2015_SPR-FM_annot.png" alt="Observed fished compositions at equilibrium" width="100%"/&gt;&lt;br /&gt;
&lt;small&gt;[(Hordyk *et al.*, 2015)](http://icesjms.oxfordjournals.org/cgi/doi/10.1093/icesjms/fst235)&lt;/small&gt;]

--

.pull-right[Abundante literature about what is a safe SPR:

* Recommended `\(SPR &gt; 0.4\)`. But a target at `\(SPR \in [0.35,0.4]\)` is also widely accepted for most life histories.
* `\(SPR \le 0.2\)` is considered unsafe (impaired recruitment).
* But of course depends on the SRR!
]

---

## The LB-SPR model

A model which implement all that, and more*, to calculate a theoretical size composition given a set
of life history traits/"invariants".

Reparametrisation of the logistic curves (fishing selectivity, maturity) for using `\(L_{50\%}\)` and
`\(L_{95\%}\)` (easier to estimate from data, widely available, etc.)

`$$S_l = \frac{1}{1 + e^{-ln(19)(l - L_{S50}) / (L_{S95} - L_{S50})}}$$`

--

.pull-left[Two important assumptions ensue:

* **=&gt; Fishing selectivity is assumed assymptotic**

* Assumes F applied with the same selectivity as the one supporting the observations.]

--

.pull-right[&lt;img src="./img/Hordyk_2015_SizeComp_noCV.png" alt="Observed compositions at equilibrium" width="40%"/&gt;
`\(\color{red}{\longrightarrow}\)`
&lt;img src="./img/Hordyk_2015_SizeComp_CV.png" alt="Observed compositions at equilibrium with CVLinf" width="38%"/&gt;
]

.footnote[[*]
  * compared to sometimes more simplistic size composition models,  
  it includes the effect of
    inter-individual growth variability (instrumental in  
    shaping the right-end of the size
    composition, particularly for low `\(M/k\)`).
  * incorporate growth-type-groups to account for differential mortality among individuals with
    different growth (aka "Lee's Phenomenon").
  * implement the possibility of having a size-varying natural mortality (`\(M/k\)` is then defined at
    `\(L_{\infty}\)`).
    
    `\(M_L = M_{L_{\infty}}\left(\frac{L_{\infty}}{L}\right)^c\)`
]

---

# Implementation - the LBSPR .medium[.remark-code[`R package`]]

To install the package (from CRAN - quite stable, so no need for development version in most cases):


``` r
install.packages("LBSPR")
```

To get started:


``` r
library(LBSPR)

vignette("LBSPR")  # Crash-course on the use of LBSPR
```

---

## Setting parameters



``` r
LBparam &lt;- new("LB_pars")

slotNames(LBparam)
#&gt;  [1] "Species"      "MK"           "M"            "Linf"         "L_units"     
#&gt;  [6] "CVLinf"       "L50"          "L95"          "Walpha"       "Walpha_units"
#&gt; [11] "Wbeta"        "FecB"         "Steepness"    "Mpow"         "R0"          
#&gt; [16] "SL50"         "SL95"         "MLL"          "sdLegal"      "fDisc"       
#&gt; [21] "FM"           "SPR"          "BinMin"       "BinMax"       "BinWidth"
```

--

Access a slot using `@`:


``` r
LBparam@CVLinf
#&gt; [1] 0.1
```

---

Setting the main parameters:


``` r
## Population parameters
LBparam@Linf &lt;- 100 # Assymptotic length (Loo)
LBparam@L50 &lt;- 65   # Maturity ogive
LBparam@L95 &lt;- 70   #  -&gt; Lm = 0.65 * Loo
LBparam@MK &lt;- 1.5   # M/k ratio

## Fisheries parameters
LBparam@SL50 &lt;- 50  # Selectivity ogive
LBparam@SL95 &lt;- 65  #  -&gt; Lc = 0.5 * Loo
LBparam@SPR &lt;- 0.4  # The spawning potential ratio at equilibrium.
                    #  Note: the F/M ratio (LBparam@FM) could be used instead.

## Data and simulation parameters:
LBparam@BinWidth &lt;- 5 # LBSPR works with binned data!
LBparam@BinMax &lt;- 150 # &gt; Loo; by default 1.3 * Loo
LBparam@BinMin &lt;- 0
```


---

## Simulations



``` r
LBsim_04 &lt;- LBSPRsim(LBparam) # Exploited, SPR = 0.4

LBparam@SPR &lt;- numeric(0)
LBparam@FM &lt;- 0
LBsim_NF &lt;- LBSPRsim(LBparam) # No fishing, SPR = 1
```
--


``` r
## Estimated parameters:
LBsim_04@FM  # F = 2/3 M in exploited case with SPR = 0.4!
#&gt; [1] 0.67
LBsim_NF@SPR # SPR estimated =1 inded when F = 0!
#&gt; [1] 1
```
---


``` r
plotSim(LBsim_NF)
```

&lt;img src="02_Introduction_LBSPR_files/figure-html/LBSPR_sim3-1.png" width="60%" style="display: block; margin: auto;" /&gt;
---


``` r
plotSim(LBsim_04)
```

&lt;img src="02_Introduction_LBSPR_files/figure-html/LBSPR_sim4-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Estimation from empirical size composition

If you have observed size data, **representative** of the size composition of the underlying
population &amp;ndash; assuming that the model assumptions are met and given user-provided life history
traits &amp;ndash; LBSPR can estimate:

 * the most likely SPR,
 * the corresponding F/M.
 * the selectivity ogive (L&lt;sub&gt;S50&lt;/sub&gt;, L&lt;sub&gt;S95&lt;/sub&gt;) of the fishery/survey, depending on the
   data origin.

...and their confidence intervals.

.full-width[.content-box-yellow[Method: **optimization of SPR** and selectivity so that the
theorethical size composition (given user-provided parameters) fits best the empirical data.]]

---

The package accepts two different formats (+ w/ or wo/ col.names) for empirical size composition data:

.pull-left[Raw data:


``` r
LenR &lt;- new("LB_lengths",
            LB_pars = LBparam,
*           file = "data/LRaw_MultiYrHead.csv",
*           dataType = "raw", header=TRUE)
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-9a8f32e39c2ba7509166" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9a8f32e39c2ba7509166">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715"],[41,35,49,52,46,45,57,57,43,75,64,52,63,65,65,75,75,35,68,66,46,29,71,78,56,74,78,60,71,93,54,74,69,55,79,81,60,53,60,54,67,57,79,43,54,89,76,56,46,60,80,59,69,48,61,56,71,60,89,71,51,64,66,52,76,69,52,77,58,70,71,42,48,68,61,75,70,59,53,79,64,82,69,66,74,57,52,73,45,55,60,61,59,87,60,83,82,75,66,61,68,68,51,81,55,62,83,82,79,81,75,52,54,68,76,60,45,31,63,68,48,89,62,72,54,60,51,77,63,44,68,70,86,68,83,49,60,80,61,67,65,64,52,63,44,67,62,62,54,46,60,47,64,77,54,83,50,45,55,68,72,55,43,61,47,48,59,59,60,66,71,67,67,74,51,41,57,71,85,49,83,58,49,67,60,49,80,51,73,63,25,79,56,47,65,63,62,51,68,99,72,55,38,69,74,103,88,79,68,60,88,40,50,50,55,65,53,75,58,68,47,54,63,60,43,84,55,44,72,79,68,61,77,90,60,53,66,65,69,44,38,49,57,49,45,61,61,45,77,68,56,65,68,70,75,76,35,72,71,50,31,71,79,58,79,81,64,75,95,55,75,73,56,83,82,63,54,65,55,69,59,82,45,58,93,76,57,48,63,82,63,72,53,66,56,73,61,92,74,52,68,70,54,80,73,53,82,58,75,74,45,49,70,66,77,74,64,53,83,68,84,74,69,74,58,56,77,48,55,65,63,62,92,63,87,83,79,66,62,69,68,55,81,60,64,86,86,84,86,77,55,56,71,78,61,46,32,65,69,51,89,66,77,54,62,55,80,63,46,68,71,91,70,85,53,65,83,66,69,68,65,56,63,45,71,66,65,54,48,65,48,69,79,58,88,51,50,57,69,77,55,47,63,48,48,63,60,64,68,72,69,69,74,55,46,58,76,86,51,85,62,53,68,64,51,83,51,73,63,28,80,59,50,65,63,67,56,69,100,74,55,39,72,75,104,92,79,69,64,92,45,53,52,55,69,58,75,61,72,49,57,63,63,48,87,58,45,74,79,72,62,81,95,60,55,68,70,72,45,37,52,51,49,43,57,55,40,77,69,50,63,63,66,79,74,35,70,69,46,30,69,83,61,71,77,58,67,91,54,73,74,55,78,86,62,49,58,57,66,54,83,41,56,91,81,52,42,59,85,55,69,46,65,51,76,64,91,68,56,69,62,51,75,65,47,73,53,71,69,38,52,70,65,73,74,60,49,80,64,84,71,61,75,54,49,69,41,55,65,62,57,84,65,81,85,74,67,56,67,69,50,79,53,67,80,78,83,76,75,54,54,63,76,57,48,34,63,63,47,92,59,67,55,55,54,76,64,44,68,72,82,69,85,54,62,77,59,68,67,67,53,61,44,71,58,66,53,46,60,50,61,79,49,83,51,42,51,70,71,55,39,63,42,51,56,64,61,65,68,64,62,75,48,41,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[64,57,74,65,55,67,64,51,67,44,68,55,71,65,60,54,50,51,67,105,75,47,87,69,52,59,60,67,49,53,61,65,65,49,69,60,61,84,60,54,98,76,38,46,42,78,27,50,47,58,98,50,54,67,55,69,65,64,63,66,64,69,72,76,52,74,67,62,65,50,51,49,80,69,47,58,62,59,59,54,54,60,68,59,57,74,79,67,55,59,66,56,42,59,63,49,51,68,77,75,68,87,64,45,42,50,86,61,56,48,74,67,55,76,55,42,73,64,53,58,65,61,68,68,40,96,32,67,48,68,60,49,44,76,70,75,66,68,69,59,70,62,81,74,78,61,87,44,55,59,45,63,58,54,83,51,59,70,96,62,87,30,48,66,51,92,79,62,75,64,54,65,63,76,78,47,69,82,59,77,54,59,70,84,87,59,45,63,55,60,64,68,92,51,67,85,63,64,48,55,62,55,74,70,59,62,61,55,62,46,72,52,67,60,56,56,45,46,65,104,72,51,89,64,53,57,59,72,51,52,66,63,66,46,65,63,57,88,63,59,95,74,39,41,39,82,22,48,50,61,97,53,55,62,58,74,68,62,65,67,68,74,67,71,49,75,68,62,62,50,54,46,82,72,52,57,63,58,61,57,56,63,65,54,61,69,77,69,52,58,67,61,46,63,61,54,53,68,82,72,70,82,65,45,40,47,86,59,61,46,76,70,58,72,56,43,69,60,48,63,65,60,69,63,35,100,30,71,53,64,57,52,46,73,67,78,65,67,74,60,72,66,83,70,79,64,87,46,58,63,41,58,54,57,87,55,58,75,97,63,86,29,53,68,49,87,84,64,80,69,57,65,63,72,83,47,69,73,64,74,67,82,77,82,65,89,46,56,59,50,63,63,59,84,56,64,70,101,65,89,32,49,67,56,94,79,62,75,64,59,67,68,80,81,51,70,83,59,80,59,60,70,85,91,63,50,68,56,60,64,70,95,56,70,87,66,68,52,56,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[67,66,44,72,44,76,60,66,58,59,54,79,58,32,85,46,56,84,62,54,77,63,56,70,58,62,88,43,60,45,46,85,71,60,63,81,55,81,78,51,53,80,69,40,76,77,82,64,55,74,74,58,62,54,47,73,70,51,53,50,54,51,64,75,50,94,73,89,52,62,41,56,57,64,76,61,47,68,59,53,77,64,67,57,57,48,43,60,75,46,49,60,54,65,78,71,67,61,59,49,62,59,47,43,78,51,92,78,50,49,63,50,66,59,54,81,61,57,49,57,66,51,82,51,85,43,73,46,54,70,65,77,76,82,78,72,82,67,56,49,40,76,43,76,41,53,60,75,69,53,67,90,59,46,87,48,67,64,72,63,54,59,61,63,74,66,71,76,65,67,68,83,91,48,73,44,41,54,80,68,47,77,71,57,66,98,64,57,66,80,77,62,61,77,62,90,58,73,53,77,63,47,51,48,67,64,58,84,39,61,76,69,43,56,84,82,50,61,33,66,83,60,84,60,64,55,42,55,51,60,46,53,39,53,78,71,50,49,52,69,71,46,75,47,76,60,71,60,60,56,82,61,32,90,49,58,88,66,58,79,64,59,70,59,62,92,45,61,47,51,88,73,60,63,83,60,83,83,55,56,80,71,43,77,80,83,64,56,75,75,63,65,56,49,78,74,52,54,53,59,51,68,75,52,99,75,89,55,66,44,61,61,68,76,63,48,70,60,54,79,69,69,59,60,49,47,63,77,49,50,64,59,66,80,72,71,65,62,50,67,61,48,45,81,53,96,81,51,53,63,55,66,61,56,85,61,59,54,60,67,53,82,54,88,43,76,49,58,71,66,77,76,85,83,74,85,72,58,51,40,78,46,81,41,53,61,78,70,54,71,95,63,47,89,52,69,65,77,68,56,63,66,68,78,68,76,77,68,72,69,87,92,51,78,46,41,56,85,73,51,81,75,57,69,102,64,58,70,81,81,62,65,77,65,95,63,76,58,78,67,47,56,53,68,65,59,85,41,66,76,72,46,61,88,85,51,61,34,68,85,62,87,64,68,59,42,58,55,61,48,55,39,57,79,72,54,49,54,68.5,71.5,67.5,69.5,74.5,59.5,54.5,67.5,78.5,65.5,36.5,46.5,69.5,100.5,76.5,64.5,54.5,95.5,76.5,79.5,73.5,63.5,62.5,59.5,56.5,62.5,47.5,80.5,63.5,96.5,93.5,78.5,58.5,84.5,76.5,59.5,67.5,95.5,52.5,70.5,64.5,76.5,60.5,53.5,51.5,64.5,58.5,66.5,52.5,45.5,91.5,53.5,73.5,68.5,89.5,55.5,64.5,56.5,56.5,61.5,47.5,64,69,43,72,45,72,60,67,55,54,52,74,59,28,88,44,57,87,63,59,74,64,54,67,56,62,92,45,59,46,50,90,75,56,59,86,58,83,73,53,48,84,68,45,73,74,78,60,51,79,72,55,58,52,47,73,66,52,53,51,49,54,63,79,47,99,74,84,50,59,43,53,55,67,81,63,49,71,58,53,72,62,62,58,58,43,48,62,79,43,50,58,51,61,79,70,72,59,60,44,63,64,47,38,83,52,96,74,49,52,60,47,69,54,55,79,65,52,53,57,69,51,80,55,89,43,77,49,58,67,65,75,78,85,80,69,78,63,58,52,35,78,39,80,38,51,63,74,67,48,62,86,56,47,92,53,64,68,67,64,55,56,64,58,71,62,73,75,60,64,66,85,96,50,68,49],[61,75,71,75,70,67,48,77,85,72,53,79,69,82,85,63,79,45,56,50,104,37,56,88,36,71,72,72,58,54,57,62,41,52,83,73,55,65,52,52,72,62,67,20,38,77,67,64,52,59,70,68,85,60,58,50,40,45,48,47,53,65,23,68,86,69,45,66,74,58,60,74,67,45,88,75,65,66,81,77,52,52,52,66,50,56,99,66,48,90,57,83,85,52,64,46,67,55,59,83,62,56,67,37,39,50,58,57,52,72,57,75,64,79,62,42,74,66,81,67,62,64,49,69,67,69,41,64,76,31,86,81,60,66,64,78,43,56,69,76,32,82,53,60,72,53,49,66,56,72,70,63,55,56,66,79,61,56,76,59,57,46,47,68,53,56,58,66,55,45,48,49,63,50,57,56,57,41,50,65,54,45,71,47,59,81,55,60,45,84,68,64,39,32,68,55,68,92,76,82,81,58,94,56,64,39,59,54,65,48,55,51,38,54,75,74,62,80,53,52,54,69,36,85,63,71,80,59,65,80,72,79,73,70,49,80,89,77,55,82,72,82,87,68,84,50,61,55,105,37,58,90,36,72,74,72,63,59,59,65,46,53,88,73,58,66,55,52,74,66,71,25,40,77,68,64,53,61,70,68,86,61,61,52,42,48,49,51,54,70,27,68,88,74,47,67,78,63,60,76,72,46,88,80,70,70,83,82,54,52,55,68,51,56,99,69,49,92,57,85,90,54,64,46,70,56,64,83,64,56,69,40,43,50,63,62,54,75,59,75,67,80,62,43,78,70,84,68,63,68,53,74,69,69,45,65,81,34,90,85,65,68,66,81,43,56,71,77,37,82,55,63,73,54,51,71,60,72,73,64,59,57,70,79,65,57,76,64,59,46,49,69,53,58,63,71,55,45,49,49,66,51,57,56,61,42,51,66,55,46,72,47,64,82,56,62,50,88,69,69,43,35,72,56,71,93,77,86,83,63,98,59,64,40,59,58,69,50,59,54,43,56,79,74,62,80,58,55,59,69,38,86,63,72,80,59,64,74,76,80,65,72,47,73,83,74,55,78,72,79,89,62,79,43,56,45,99,34,56,88,31,66,74,69,54,56,55,62,39,52,84,77,50,62,48,52,67,61,67,18,41,76,62,65,50,63,66,66,83,57,58,47,42,50,48,44,55,66,28,68,91,69,40,69,75,56,59,78,64,49,85,70,69,64,76,78,55,53,47,64,55,61,94,65,46,92,56,82,87,55,67,41,62,58,61,82,58,61,63,32,37,52,59,61,51,76,53,70,61,83,61,44,79,70,79,72,57,64,49,67,72,67,43,68,71,27,81,86,62,62,62,78,43,55,74,77,37,78,57,63,74,57,49,68,59,69,71,63,52,54,64,80,60,54,80,60,59,43,43,67,55,51,55,64,51,45,50,53,61,53,62,56,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[51,86,51,72,69,72,54,54,60,69,60,63,45,56,55,51,69,62,44,67,69,44,76,56,56,67,57,39,57,72,41,87,46,58,77,52,28,36,47,72,80,68,65,44,63,66,56,58,64,45,62,26,78,58,40,51,59,55,80,86,99,71,72,56,70,65,61,63,85,52,30,79,74,70,30,60,55,61,91,91,65,53,60,58,81,42,61,76,71,57,76,84,52,71,58,62,62,49,60,59,40,70,55,71,44,72,64,95,9,66,61,74,106,66,60,101,48,67,65,50,48,71,54,43,56,82,53,45,55,87,71,68,48,53,52,71,39,65,66,56,60,63,67,87,69,69,54,72,61,66,69,60,73,78,45,59,51,57,75,47,62,100,42,70,54,79,79,72,64,53,36,42,47,59,46,66,61,50,56,48,53,88,55,72,73,74,58,55,63,69,65,65,50,61,56,55,74,64,49,71,71,47,77,57,59,67,59,42,59,72,46,89,49,58,78,55,31,40,48,77,85,68,65,47,63,68,60,58,65,46,64,29,83,62,43,53,62,60,81,87,100,72,74,60,71,69,64,68,89,56,32,82,77,75,35,63,55,62,95,95,69,54,64,59,86,43,66,79,73,62,81,84,55,72,61,66,64,51,61,59,40,72,57,75,47,77,67,100,12,67,65,76,111,70,65,104,52,68,69,55,50,75,54,43,59,82,53,48,60,89,76,73,51,57,54,76,40,66,70,56,62,63,67,92,71,73,59,77,61,71,69,63,74,79,49,59,56,61,75,48,63,105,42,71,56,79,84,75,65,55,38,46,49,61,48,68,63,53,60,53,50,81,55,67,68,72,51,53,60,67,56,66,45,52,52,52,73,60,40,64,71,41,78,51,55,66,53,39,61,77,41,87,42,58,80,55,26,34,48,72,80,69,70,48,63,71,55,62,69,45,62,31,83,60,39,49,64,55,80,87,103,67,74,52,74,63,60,64,87,55,31,80,79,70,32,64,60,62,87,86,65,48,61,53,77,41,60,72,70,61,77,86,52,70,60,66,61,45,61,62,39,72,53,74,44,69,61,94,9,71,59,73,109,65,65,104,44,68,63,54,47,73,57,38,59,83,56,43,53,82,71,73,47,54,53,74,37,70,62,60,58,59,64,91,72,69,55,69,60,69,70,57,74,73,50,62,53,62,71,52,63,104,40,69,54,82,75,67,63,49,37,44,46,59,42,66,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[42,58,56,53,66,51,43,59,45,59,63,76,54,58,47,68,54,73,46,47,59,75,56,84,85,91,69,44,53,58,82,64,78,71,60,54,51,63,49,49,67,59,82,55,63,74,56,76,77,60,77,68,42,59,38,60,117,66,80,54,39,57,71,71,53,70,55,80,81,69,62,58,93,76,61,62,52,62,63,56,88,59,58,44,66,66,64,58,48,72,73,91,43,87,59,63,71,81,51,50,61,52,76,72,63,69,84,45,42,38,67,75,49,76,61,68,74,64,55,47,52,58,71,58,86,70,64,64,94,71,62,44,66,82,56,97,62,57,72,96,61,60,54,59,87,67,62,87,65,64,84,43,65,40,65,56,71,47,70,59,62,69,48,64,85,32,66,47,49,64,55,86,48,63,95,70,62,69,63,43,62,66,63,83,78,62,79,86,51,88,67,61,59,40,80,53,77,73,62,51,62,54,71,77,63,62,69,68,65,59,77,54,40,58,67,80,76,60,80,77,48,66,74,69,88,99,58,57,62,68,68,57,58,40,67,56,54,58,53,43,59,57,54,68,52,44,61,48,60,63,76,57,62,51,69,57,73,47,50,61,75,59,84,86,96,73,47,57,63,85,68,81,71,64,54,51,66,53,50,71,62,87,56,67,74,60,78,79,62,79,71,47,64,43,65,118,66,84,56,42,57,71,75,55,73,58,80,85,73,66,58,95,77,65,65,56,66,63,56,88,61,60,49,68,70,65,62,51,77,76,96,45,89,63,66,72,84,56,53,66,57,80,75,63,71,86,46,46,40,70,77,49,76,65,71,74,66,56,47,53,62,74,60,86,72,69,64,99,76,66,48,71,83,57,100,64,61,72,98,64,61,59,61,87,68,64,89,68,66,88,48,69,40,66,61,71,49,73,62,63,71,49,64,87,32,71,48,52,64,59,88,51,66,98,72,67,74,68,47,65,70,65,88,83,64,81,89,56,93,69,61,62,41,83,53,79,73,64,54,66,56,73,80,64,62,74,70,69,60,77,57,44,59,71,84,79,63,82,82,53,67,77,72,89,101,61,60,64,68,73,60,58,41,72,56,58,60,54,69.5,45.5,93.5,61.5,52.5,65.5,64.5,88.5,50.5,80.5,72.5,79.5,53.5,65.5,67.5,59.5,42.5,71.5,62.5,61.5,73.5,45.5,50.5,90.5,52.5,88.5,63.5,75.5,65.5,49.5,60.5,43,53,61,52,68,50,45,60,42,54,64,75,50,57,48,73,57,77,41,45,56,78,60,83,87,94,64,43,56,55,80,64,79,69,61,55,55,64,50,53,66,60,79,59,61,69,56,80,74,57,72,65,41,61,38,56,122,71,76,56,37,52,68,73,50,72,54,78,84,68,61,58,91,72,62,63,52,63,62,52,83,55,63,47,67,69,68,59,48,71,75,93,46,91,54,61,67,81,55,46,66,52,73,72,61,65,81,45,40,39,64,74,45,77,57,65,74,66,51,42,52,58,69,63,91,70,67,60,93,69,59,42,63,84,54,97,66,52,71,98,65,56,51,63,89,72,59,82,70,69,82,47,64,38,67,58,73,45,68,59,67,72,44,66,81,35,68,46,54,68,50,84,48,58,95,71,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>X2010<\/th>\n      <th>X2011<\/th>\n      <th>X2012<\/th>\n      <th>X2013<\/th>\n      <th>X2014<\/th>\n      <th>X2015<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":25,"scrollY":"180px","columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"X2010","targets":1},{"name":"X2011","targets":2},{"name":"X2012","targets":3},{"name":"X2013","targets":4},{"name":"X2014","targets":5},{"name":"X2015","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
]

.pull-right[Binned and tabulated:


``` r
LenF &lt;- new("LB_lengths",
            LB_pars = LBparam,
*           file = "data/LFreq_MultiYrHead.csv",
*           dataType = "freq", header=TRUE)
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-86d6cb7e40c02a3996ca" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-86d6cb7e40c02a3996ca">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26"],[2.5,7.5,12.5,17.5,22.5,27.5,32.5,37.5,42.5,47.5,52.5,57.5,62.5,67.5,72.5,77.5,82.5,87.5,92.5,97.5,102.5,107.5,112.5,117.5,122.5,127.5],[0,0,0,0,0,6,0,36,78,126,156,252,192,126,180,138,48,36,42,6,12,0,0,0,0,0],[0,0,0,6,0,6,6,42,96,102,174,246,192,162,138,84,72,48,24,24,12,0,0,0,0,0],[0,0,0,0,0,6,6,30,66,126,222,216,144,150,210,114,66,30,24,12,12,0,0,0,0,0],[0,0,0,0,0,0,18,60,42,102,192,228,174,180,114,132,78,48,42,12,12,0,0,0,0,0],[0,0,0,0,0,0,12,30,66,114,174,288,234,156,108,78,108,24,24,0,18,0,0,0,0,0],[0,0,0,0,0,6,18,36,78,150,180,198,168,168,132,90,96,48,36,24,0,6,0,0,0,0]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Length<\/th>\n      <th>X2010<\/th>\n      <th>X2011<\/th>\n      <th>X2012<\/th>\n      <th>X2013<\/th>\n      <th>X2014<\/th>\n      <th>X2015<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":25,"scrollY":"180px","columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Length","targets":1},{"name":"X2010","targets":2},{"name":"X2011","targets":3},{"name":"X2012","targets":4},{"name":"X2013","targets":5},{"name":"X2014","targets":6},{"name":"X2015","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
]

---






``` r

plotSize(LB_obj = LenR)
```

&lt;img src="02_Introduction_LBSPR_files/figure-html/unnamed-chunk-5-1.png" width="55%" style="display: block; margin: auto;" /&gt;

---

## Estimation from empirical size composition



``` r
fitted &lt;- LBSPRfit(LB_pars = LBparam,
                   LB_lengths = LenR)
```


``` r
## Explore the fitted object (&gt; slotNames(fitted) to see the available objects):
fitted@SPR
#&gt; [1] 0.3777927 0.3662504 0.4758815 0.3725293 0.4128085 0.4721993

fitted@FM
#&gt; [1] 0.79 0.80 0.50 0.80 0.67 0.54

fitted@SL50
#&gt; [1] 53.00 52.09 48.38 52.67 51.26 51.31

fitted@Ests  ## parameters estimates smoothed across years...
#&gt;       SL50  SL95   FM  SPR
#&gt; [1,] 51.50 68.00 0.71 0.40
#&gt; [2,] 51.41 67.81 0.70 0.41
#&gt; [3,] 51.24 67.64 0.68 0.41
#&gt; [4,] 51.36 68.15 0.68 0.41
#&gt; [5,] 51.35 68.24 0.67 0.42
#&gt; [6,] 51.34 68.06 0.66 0.42

fitted@Vars  ## ...and their uncertainty
#&gt;          SL50     SL95          FM         SPR
#&gt; [1,] 3.174526 8.256211 0.020194938 0.002341736
#&gt; [2,] 2.089426 5.625074 0.019895461 0.002390166
#&gt; [3,] 1.232290 3.929145 0.007306363 0.002537982
#&gt; [4,] 3.740706 9.346823 0.021390116 0.002451090
#&gt; [5,] 3.167672 8.038541 0.016378125 0.002922773
#&gt; [6,] 1.715353 4.695238 0.009717970 0.002628945
```

---

.pull-left[

``` r
plotSize(LB_obj = fitted)
```

&lt;img src="02_Introduction_LBSPR_files/figure-html/unnamed-chunk-8-1.png" width="60%" style="display: block; margin: auto;" /&gt;


``` r
plotMat(LB_obj = fitted)
```

&lt;img src="02_Introduction_LBSPR_files/figure-html/unnamed-chunk-9-1.png" width="50%" style="display: block; margin: auto;" /&gt;
]

.pull-right[

``` r
plotEsts(LB_obj = fitted)
```

&lt;img src="02_Introduction_LBSPR_files/figure-html/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

### Examples of graphic outputs on real data (monkfish in Norway, north of 62&amp;deg;N; credit Kotaro Ono):

&lt;img src="./img/LBSPR_monkfish_sz.png" alt="LBSPR fitted to monkfish size distribution" width="49%"/&gt;
&lt;img src="./img/LBSPR_monkfish_params.png" alt="LBSPR fitted to monkfish parameters" width="49%"/&gt;

---

.pull-left[# Use for management

**A lots of advantages:**

Rely on data that are (relatively) cheap and easy to collect.  
Designed to work best with fisheries-dependent data (size composition equilibrium integrates removal
with selectivity estimated from the data)... observer/self-sampling vs. commisioning a survey
vessel!

Considered quite robust. One of the few models to account for different mortality rates among
individuals of the same age-group growing at different paces ("Lee's phenomeon").

Possibility to estimate (MSY proxy) reference points... if the steepness of the SRR is known.  
(spoiler alerte: it rarely is!)

Simulation tool: quite handy for some applications.
]

.pull-right[

``` r
LBparam2 &lt;- LBparam
LBparam2@Steepness &lt;- 0.9

## Re-run with different steepness:
fitted2 &lt;- LBSPRfit(LB_pars = LBparam2,
                    LB_lengths = LenR)

## and then plot exploitation
##  curves using plotCurves(fitted2)
```

&lt;img src="02_Introduction_LBSPR_files/figure-html/unnamed-chunk-12-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

--



**=&gt; One of the most popular size-based models nowadays!**

---

## Conditions for applicability

 &lt;br /&gt;

Model assumptions will never be fully met, but "close enough" is essential.

 &lt;br /&gt;

.full-width[.content-box-yellow[**An important aspect of the expertise resides in evaluating what is
"close enough"!**]]

---

Most important assumptions:

 * **The size distribution is representative** of the population (on the right side). &lt;br /&gt; Quite
   difficult to evaluate, but really essential. &lt;br /&gt; This will often come down to the questions:
   * Is the sampled fraction representative of the whole population?
   * Is the sampling design properly accounted for while raising the size composition? (_E.g._
     stratification if spatial heterogeneity, raising to catch in primary sampling unit, etc.)
   * **Is the gear selectivity asymptotic?** &lt;br /&gt; Although it could theoretically work with
     different patterns, LBSPR assumes an asymptotic selectivity curve.

---

Most important assumptions:

 * **The population is at equilibrium**. &lt;br /&gt; A number of situations may raise concern about this:
   * Recent&lt;sup&gt;1&lt;/sup&gt; .footnote[&lt;sup&gt;1&lt;/sup&gt;This has to be evaluated in relation to the longevity
     and generation time of the species.] settlement; the population did not have time to reach
     equilibrium.
   * Strong and frequent&lt;sup&gt;1&lt;/sup&gt; variations in the exploitation level and or pattern: no time
     for reaching different equilibrium between change.
   * Strong variations (pulses) and/or trends (_e.g._ regime shift, strong auto-correlation in time)
     in the recruitment may also prevent equilibrium.


---

.pull-left[
Most important assumptions:

 * **Relevant life history "invariants"** &lt;br /&gt; LB-SPR is sensitive to parameter misspecifications,
   in particular:

    * `\(L_{\infty}\)`: scales everything! &lt;br /&gt; &lt;span style="color:darkred;"&gt;Beware of the
      temperature-size rule!!&lt;/span&gt;
    * `\(M/k\)`: one of the primary parameters controling the shape at equilibrium...
    * ...while `\(CV_{L_{\infty}}\)` controls mostly the right skewness (less sensitive at large `\(M/k\)`,
   but rarely known, so very uncertain).  ]

.pull-right[

&lt;img src="02_Introduction_LBSPR_files/figure-html/LBSPR-shapes-1.png" style="display: block; margin: auto;" /&gt;
]

--
 &lt;br /&gt;

.center[.content-box-yellow[You should always well document your LHT choices, and perform a
sensitivity analysis]]

---

## Empirical evidence / success

Empirical evidence is quite difficult to gather, as evaluating management strategies in the real world takes a long time, but:

--

* growing portfolio of documented success stories (*e.g.* Prince *et al.*, 2020), despite the relatively young
  age of the model implementation (~10 years).

* based on strong theoretical fundations.
  
  (I hope I managed to convinced you of that one!)

* tested and validated using MSE (refs.)

=&gt; widely used, and endorsed by scientifc organisations such as ICES.


&lt;br /&gt;
***
&lt;small&gt;Prince, J., Creech, S., Madduppa, H., and Hordyk, A. 2020. Length based assessment of spawning
potential ratio in data-poor fisheries for blue swimming crab (Portunus spp.) in Sri Lanka and
Indonesia: Implications for sustainable management. Regional Studies in Marine Science,
36: 101309. https://doi.org/10.1016/j.rsma.2020.101309.  &lt;/small&gt;

---

## Known limitations

It also has a few flaws:

* reliance on the equilibrium assumption is strong.

* only implemented for an asymptotic, mono-modal fisheries selectivity, while dome-shaped
  selectivity is not-uncommon.

* sensitivity to input parameters, some of which are quite uncertain in most cases (refs.)... that
  is true of so many assessment methods, including data rich, though!

* as of now, not able to impose some correlation on estimates among years (*e.g.* selectivity, if
  one knows that practices/fishing patterns are not changing much among years).

* may "spit" seemingly consistent results, however poor one's choice of data and LHT is.


&lt;!-- Local Variables: --&gt;
&lt;!-- coding: utf-8 --&gt;
&lt;!-- ispell-local-dictionary: "english" --&gt;
&lt;!-- fill-column: 100 --&gt;
&lt;!-- End: --&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
